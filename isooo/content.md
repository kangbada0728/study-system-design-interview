# 4장: 처리율 제한 장치의 설계
처리율 제한 장치
- 클라이언트/서비스가 보내는 트래픽의 처리율을 제어하기 위한 장치
    - e.g. 특정 기간 내 전송되는 클라이언트의 api 요청 횟수가, 제한 장치에 정의된 임계치를 넘어서면, 추가로 도달한 모든 호출은 처리가 block된다

이점
- 악의적인 사용자가 시스템 자원을 낭비하는 것을 제한하여 정상 사용자의 접근을 보장
- 요청 처리에 대한 비용 절감
- 서버 과부하를 막고 안정정 상태 유지 가능

구현 방법
- 주로 API 게이트웨이나 로드 밸런서에 구현 가능
    - 요청 수를 체크하고, limit을 초과하는 요청은 거부하거나 지연 시키는 역할 수행

처리율 제한에 사용되는 알고리즘
- 토큰 버킷
- 누출 버킷
- 고정 윈도 카운터, 이동 윈도 로그, 이동 윈도 카운터 ...

요청 거부/지연 예시
- 요청 거부
    - 서버에서 요청을 거부하면 클라이언트는 일반적으로 `HTTP 429 Too Many Requests` 상태코드를 받음. 이는 '클라이언트가 지정된 시간 동안 너무 많은 요청을 보냈다'는 것
    - 응답 헤더에 `Retry-After`를 포함시켜, 사용자가 다시 시도하기 전에 기다려야 하는 권장 시간을 제공할 수도 있다
    - 클라이언트에게 custom한 에러 메시지 보내기..
- 요청 지연
    - 초과된 요청을 queue에 넣고, 처리율이 한계보다 떨어졌을 때 해당 요청을 서비스 
    - ==> 지연 로직은 주로 시스템 처리율은 유지하면서 동시에 사용자 요청은 최대한 유실하지 않고자 할 때 유용
        - 사용자 경험을 개선하거나, 실시간성이 요구되지 않는 요청에 적절

<br/>

# 5장: 안정 해시 설계
안정 해시
- 분산 시스템에서 데이터를 여러 노드에 분산시키는 방법 중 하나

이점
- 데이터가 보다 균등하게 분포하게 되어, 수평적 규모 확장이 쉽다
    - 노드가 N대일 때, 대략적으로 비슷한 양의 데이터를 처리하도록 분배 가능
- 서버가 추가/삭제될 때 재배치되는 키의 수가 최소화된다
- 높은 가용성/확장성
    - 노드 하나가 죽어도 해당 노드에 할당된 key만 영향을 받음 -> 전체 시스템으로 전파되는 것 방지 가능
- 핫스팟 키 문제를 줄인다
    - 특정 샤드에 대한 접근이 지나치게 빈번하면 서버 과부하문제가 발생할 수 있는 문제를 줄일 수 있음
